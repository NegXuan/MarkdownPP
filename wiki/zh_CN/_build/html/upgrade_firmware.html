

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>升级固件 &mdash; Firefly Wiki</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="MaskRom模式" href="maskrom_mode.html" />
    <link rel="prev" title="烧写须知(重要)" href="upgrade_table.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Firefly-RK3399 Manual
          

          
            
            <img src="_static/Logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">上手教程</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="started.html">入手指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">串口调试</a></li>
</ul>
<p class="caption"><span class="caption-text">烧写固件</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="bootmode.html">启动模式说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade_table.html">烧写须知(重要)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">升级固件</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#qian-yan">前言</a></li>
<li class="toctree-l2"><a class="reference internal" href="#zhun-bei-gong-zuo">准备工作</a></li>
<li class="toctree-l2"><a class="reference internal" href="#windows">Windows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#an-zhuang-rk-usb-qu-dong">安装 RK USB 驱动</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lian-jie-she-bei">连接设备</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#shao-xie-gu-jian">烧写固件</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#shao-xie-tong-yi-gu-jian-update-img">烧写统一固件 update.img</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shao-xie-fen-qu-ying-xiang">烧写分区映像</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#linux">Linux</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#upgrade-tool">upgrade_tool</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#chang-jian-wen-ti">常见问题</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ru-he-qiang-xing-jin-ru-maskrom-mo-shi">如何强行进入 MaskRom 模式</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="maskrom_mode.html">MaskRom模式</a></li>
</ul>
<p class="caption"><span class="caption-text">Linux开发</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="linux_build_ubuntu_rootfs.html">创建 Ubuntu 根文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="linux_compile_gpt.html">编译 Ubuntu 固件 ( GPT )</a></li>
<li class="toctree-l1"><a class="reference internal" href="ubuntu_support.html">Ubuntu 应用层支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="buildroot_compile.html">编译 Buildroot 固件</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Firefly-RK3399 Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>升级固件</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/upgrade_firmware.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sheng-ji-gu-jian">
<h1>升级固件<a class="headerlink" href="#sheng-ji-gu-jian" title="永久链接至标题">¶</a></h1>
<div class="section" id="qian-yan">
<h2>前言<a class="headerlink" href="#qian-yan" title="永久链接至标题">¶</a></h2>
<p>本文介绍了如何将主机上的固件文件，通过 双公头 USB 数据线烧录到开发板的闪存中。升级时，需要根据主机操作系统和固件类型来选择合适的升级方式。</p>
</div>
<div class="section" id="zhun-bei-gong-zuo">
<h2>准备工作<a class="headerlink" href="#zhun-bei-gong-zuo" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>AIO-3399J 开发板</p></li>
<li><p>固件</p></li>
<li><p>主机</p></li>
<li><p>良好的双公头 USB 数据线文介绍了如何将主机上的固件文件，通过双公头 USB 数据线烧录到开发板的闪存中。升级时，需要根据主机操作系统和固件类型来选择合适的升级方式。</p></li>
</ul>
<p>固件文件一般有两种：</p>
<ul class="simple">
<li><p>单个统一固件 update.img, 将启动加载器、参数和所有分区镜像都打包到一起，用于固件发布。</p></li>
<li><p>多个分区镜像,如 kernel.img, rootfs.img, recovery.img 等，在开发阶段生成。</p></li>
<li><p>可以在这里找到已编译好的统一 <a class="reference external" href="http://http://www.t-firefly.com/doc/download/page/id/31.html#other_80">AIO-3399J 固件</a>，下载后解压。也可以参考编译固件的说明自行编译。</p></li>
</ul>
<p>主机操作系统支持：</p>
<blockquote>
<div><ul class="simple">
<li><p>Windows XP （32/64位）</p></li>
<li><p>Windows 7 (32/64位)</p></li>
<li><p>Windows 8 (32/64位)</p></li>
<li><p>Linux (32/64位)</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="windows">
<h2>Windows<a class="headerlink" href="#windows" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>工具: <a class="reference external" href="http://www.t-firefly.com/doc/download/page/id/54.html#windows_12">Androidtool_xxx(版本号)</a></p></li>
</ul>
<p><strong><font color=#ff0000 >注意</font></strong>:不同固件使用的工具版本可能不同,请根据<a class="reference external" href="upgrade_table.html">烧写须知</a>下载对应的版本</p>
<div class="section" id="an-zhuang-rk-usb-qu-dong">
<h3>安装 RK USB 驱动<a class="headerlink" href="#an-zhuang-rk-usb-qu-dong" title="永久链接至标题">¶</a></h3>
<p>下载 <a class="reference external" href="http://www.t-firefly.com/doc/download/page/id/3.html#other_11"> Release_DriverAssistant.zip</a> ，解压，然后运行里面的 DriverInstall.exe 。为了所有设备都使用更新的驱动，请先选择<code class="docutils literal notranslate"><span class="pre">驱动卸载</span></code>，然后再选择<code class="docutils literal notranslate"><span class="pre">驱动安装</span></code>。</p>
<p><img alt="_images/upgrade_firmware1.png" src="_images/upgrade_firmware1.png" /></p>
</div>
<div class="section" id="lian-jie-she-bei">
<h3>连接设备<a class="headerlink" href="#lian-jie-she-bei" title="永久链接至标题">¶</a></h3>
<p>设备进入升级模式的方式如下：</p>
<ul class="simple">
<li><p>一种方法是设备先断开电源适配器和双公头 USB 数据线的连接：</p>
<ul>
<li><p>双公头 USB 数据线一端连接主机，一端连接开发板</p></li>
<li><p>按住设备上的 RECOVERY （恢复）键并保持</p></li>
<li><p>接上电源</p></li>
<li><p>大约两秒钟后，松开 RECOVERY 键</p></li>
</ul>
</li>
<li><p>另一种方法，无需断开电源适配器和双公头 USB 数据线的连接：</p>
<ul>
<li><p>双公头 USB 数据线一端连接主机，一端连接开发板</p></li>
<li><p>按住设备上的 RECOVERY （恢复）键并保持</p></li>
<li><p>短按一下 RESET（复位）键</p></li>
<li><p>大约两秒钟后，松开 RECOVERY 键</p></li>
</ul>
</li>
</ul>
<p>主机应该会提示发现新硬件并配置驱动。打开设备管理器，会见到新设备 <code class="docutils literal notranslate"><span class="pre">Rockusb</span> <span class="pre">Device</span></code> 出现，如下图。如果没有，则需要返回上一步重新安装驱动。</p>
<p><img alt="_images/upgrade_firmware2.png" src="_images/upgrade_firmware2.png" /></p>
</div>
</div>
<div class="section" id="shao-xie-gu-jian">
<h2>烧写固件<a class="headerlink" href="#shao-xie-gu-jian" title="永久链接至标题">¶</a></h2>
<p>下载 <a class="reference external" href="http://www.t-firefly.com/doc/download/page/id/3.html#windows_12">AndroidTool</a>(<strong>若系统是Android8.1则需要2.54以上版本</strong>)，解压，运行 AndroidTool_Release_v2.38 目录里面的 AndroidTool.exe（注意，如果是 Windows 7/8,需要按鼠标右键，选择以管理员身份运行），如下图：
<img alt="_images/upgrade_firmware3.png" src="_images/upgrade_firmware3.png" /></p>
<div class="section" id="shao-xie-tong-yi-gu-jian-update-img">
<h3>烧写统一固件 update.img<a class="headerlink" href="#shao-xie-tong-yi-gu-jian-update-img" title="永久链接至标题">¶</a></h3>
<p>烧写统一固件 update.img 的步骤如下:</p>
<ol class="simple">
<li><p>切换至<code class="docutils literal notranslate"><span class="pre">升级固件</span></code>页。</p></li>
<li><p>按<code class="docutils literal notranslate"><span class="pre">固件</span></code>按钮，打开要升级的固件文件。升级工具会显示详细的固件信息。</p></li>
<li><p>按<code class="docutils literal notranslate"><span class="pre">升级</span></code>按钮开始升级。</p></li>
<li><p><font color=#ff0000 >如果升级失败，可以尝试先按<code class="docutils literal notranslate"><span class="pre">擦除</span> <span class="pre">Flash</span> </code>按钮来擦除 Flash，然后再升级。一定要根据<a class="reference internal" href="upgrade_table.html"><span class="doc">烧写须知</span></a>进行擦除烧写</font></p></li>
</ol>
<p><strong>注意：如果你烧写的固件 laoder 版本与原来的机器的不一致，请在升级固件前先执行<code class="docutils literal notranslate"><span class="pre">擦除</span> <span class="pre">Flash</span> </code>。</strong></p>
<p><img alt="_images/upgrade_firmware4.png" src="_images/upgrade_firmware4.png" /></p>
</div>
<div class="section" id="shao-xie-fen-qu-ying-xiang">
<h3>烧写分区映像<a class="headerlink" href="#shao-xie-fen-qu-ying-xiang" title="永久链接至标题">¶</a></h3>
<p>每个固件的分区可能不相同,请注意以下两点:</p>
<ol>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">Androidtool_2.38</span></code> 烧写 <code class="docutils literal notranslate"><span class="pre">ubuntu(MBR)</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Android7.1</span></code> 固件时使用默认配置即可;</p></li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">Androidtool_2.58</span></code> 烧写 <code class="docutils literal notranslate"><span class="pre">ubuntu(GPT)</span></code> 使用默认配置即可，烧写 <code class="docutils literal notranslate"><span class="pre">Android8.1</span></code> 固件请先执行以下操作:</p>
<p><font color=#ff0000 >切换至<code class="docutils literal notranslate"><span class="pre">下载镜像页面</span></code>; 右键点击表格，选择<code class="docutils literal notranslate"><span class="pre">导入配置</span></code>; 选择rk3399-Android81.cfg</font></p>
</li>
</ol>
<p>烧写分区映像的步骤如下：</p>
<ol class="simple">
<li><p>切换至<code class="docutils literal notranslate"><span class="pre">下载镜像</span></code>页。</p></li>
<li><p>勾选需要烧录的分区，可以多选。</p></li>
<li><p>确保映像文件的路径正确，需要的话，点路径右边的空白表格单元格来重新选择。</p></li>
<li><p>点击<code class="docutils literal notranslate"><span class="pre">执行</span></code>按钮开始升级，升级结束后设备会自动重启。</p></li>
</ol>
<p><img alt="_images/upgrade_firmware3.png" src="_images/upgrade_firmware3.png" /></p>
</div>
</div>
<div class="section" id="linux">
<h2>Linux<a class="headerlink" href="#linux" title="永久链接至标题">¶</a></h2>
<p>Linux 下无须安装设备驱动，参照 Windows 章节连接设备则可。</p>
<ul class="simple">
<li><p>工具:<a class="reference external" href="http://www.t-firefly.com/doc/download/page/id/54.html#linux_12">upgrade_tool_xxx(版本号)</a></p></li>
</ul>
<p><strong><font color=#ff0000 >注意</font></strong>:不同固件使用的工具版本可能不同,请根据<a class="reference external" href="upgrade_table.html">烧写须知</a>下载对应的版本</p>
<div class="section" id="upgrade-tool">
<h3>upgrade_tool<a class="headerlink" href="#upgrade-tool" title="永久链接至标题">¶</a></h3>
<p>下载 <a class="reference external" href="http://www.t-firefly.com/doc/download/page/id/31.html#linux_12">Linux_Upgrade_Tool</a> (<strong>系统是 Android8.1 则需要 Linux_Upgrde_Tool_for_android8.1</strong>), 并按以下方法安装到系统中，方便调用：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unzip</span> <span class="n">Linux_Upgrade_Tool_xxxx</span><span class="o">.</span><span class="n">zip</span>
<span class="n">cd</span> <span class="n">Linux_UpgradeTool_xxxx</span>
<span class="n">sudo</span> <span class="n">mv</span> <span class="n">upgrade_tool</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span>
<span class="n">sudo</span> <span class="n">chown</span> <span class="n">root</span><span class="p">:</span><span class="n">root</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">upgrade_tool</span>
<span class="n">sudo</span> <span class="n">chmod</span> <span class="n">a</span><span class="o">+</span><span class="n">x</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">upgrade_tool</span>
</pre></div>
</div>
<p>烧写统一固件 update.img：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">upgrade_tool</span> <span class="n">uf</span> <span class="n">update</span><span class="o">.</span><span class="n">img</span>
</pre></div>
</div>
<p><font color=#ff0000 >如果升级失败，可以尝试先擦除后再升级。一定要根据<a class="reference external" href="upgrade_table.html">烧写须知</a>的表格 (upgrade_table.md) 进行擦除烧写</font></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 擦除 flash 使用 ef 参数需要指定 loader 文件或者对应的 update.img</span>
<span class="n">sudo</span> <span class="n">upgrade_tool</span> <span class="n">ef</span> <span class="n">update</span><span class="o">.</span><span class="n">img</span>   <span class="c1">#update.img :你需要烧写的 Ubuntu 固件</span>
<span class="c1"># 重新烧写</span>
<span class="n">sudo</span> <span class="n">upgrade_tool</span> <span class="n">uf</span> <span class="n">update</span><span class="o">.</span><span class="n">img</span>
</pre></div>
</div>
<p>烧写分区镜像：
Ubuntu(MBR)、Android7.1、Android8.1,使用以下方式:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">upgrade_tool</span> <span class="n">di</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">boot</span><span class="o">.</span><span class="n">img</span>
<span class="n">sudo</span> <span class="n">upgrade_tool</span> <span class="n">di</span> <span class="o">-</span><span class="n">k</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">kernel</span><span class="o">.</span><span class="n">img</span>
<span class="n">sudo</span> <span class="n">upgrade_tool</span> <span class="n">di</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">system</span><span class="o">.</span><span class="n">img</span>
<span class="n">sudo</span> <span class="n">upgrade_tool</span> <span class="n">di</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">recovery</span><span class="o">.</span><span class="n">img</span>
<span class="n">sudo</span> <span class="n">upgrade_tool</span> <span class="n">di</span> <span class="o">-</span><span class="n">m</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">misc</span><span class="o">.</span><span class="n">img</span>
<span class="n">sudo</span> <span class="n">upgrade_tool</span> <span class="n">di</span> <span class="n">resource</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">resource</span><span class="o">.</span><span class="n">img</span>
<span class="n">sudo</span> <span class="n">upgrade_tool</span> <span class="n">di</span> <span class="o">-</span><span class="n">p</span> <span class="n">paramater</span>   <span class="c1">#烧写 parameter</span>
<span class="n">sudo</span> <span class="n">upgrade_tool</span> <span class="n">ul</span> <span class="n">bootloader</span><span class="o">.</span><span class="n">bin</span> <span class="c1"># 烧写 bootloader</span>
</pre></div>
</div>
<p>Ubuntu(GPT),使用以下方式</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo upgrade_tool ul $LOADER
sudo upgrade_tool di -p $PARAMETER
sudo upgrade_tool di -uboot $UBOOT
sudo upgrade_tool di -trust $TRUST
sudo upgrade_tool di -b $BOOT
sudo upgrade_tool di -r $RECOVERY
sudo upgrade_tool di -m $MISC
sudo upgrade_tool di -oem $OEM
sudo upgrade_tool di -userdata $USERDATA
sudo upgrade_tool di -rootfs $ROOTFS
</pre></div>
</div>
<p>如果因 flash 问题导致升级时出错，可以尝试低级格式化、擦除 nand flash：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">upgrade_tool</span> <span class="n">lf</span> <span class="n">update</span><span class="o">.</span><span class="n">img</span>	<span class="c1"># 低级格式化</span>
<span class="n">sudo</span> <span class="n">upgrade_tool</span> <span class="n">ef</span> <span class="n">update</span><span class="o">.</span><span class="n">img</span>	<span class="c1"># 擦除</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="chang-jian-wen-ti">
<h2>常见问题<a class="headerlink" href="#chang-jian-wen-ti" title="永久链接至标题">¶</a></h2>
<div class="section" id="ru-he-qiang-xing-jin-ru-maskrom-mo-shi">
<h3>如何强行进入 MaskRom 模式<a class="headerlink" href="#ru-he-qiang-xing-jin-ru-maskrom-mo-shi" title="永久链接至标题">¶</a></h3>
<p>如果板子进入不了 Loader 模式，此时可以尝试强行进入 MaskRom 模式。操作方法见<a class="reference external" href="maskrom_mode.html">《如何进入 MaskRom 模式》</a>。</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="maskrom_mode.html" class="btn btn-neutral float-right" title="MaskRom模式" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="upgrade_table.html" class="btn btn-neutral float-left" title="烧写须知(重要)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Firefly Team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>